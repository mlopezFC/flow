window.vaadinPush=window.vaadinPush||{};(function(a){(function(b,c){if(typeof a==="function"&&a.amd){a(c)}else{if(typeof exports!=="undefined"){module.exports=c()}else{b.atmosphere=c()}}}(this,function(){var b={},e,d=false,h=[],g=[],f=0,c=Object.prototype.hasOwnProperty;b={version:"3.1.0-javascript",onError:function(i){},onClose:function(i){},onOpen:function(i){},onReopen:function(i){},onMessage:function(i){},onReconnect:function(j,i){},onMessagePublished:function(i){},onTransportFailure:function(j,i){},onLocalMessage:function(i){},onFailureToReconnect:function(j,i){},onClientTimeout:function(i){},onOpenAfterResume:function(i){},WebsocketApiAdapter:function(j){var i,k;j.onMessage=function(l){k.onmessage({data:l.responseBody})};j.onMessagePublished=function(l){k.onmessage({data:l.responseBody})};j.onOpen=function(l){k.onopen(l)};k={close:function(){i.close()},send:function(l){i.push(l)},onmessage:function(l){},onopen:function(l){},onclose:function(l){},onerror:function(l){}};i=new b.subscribe(j);return k},AtmosphereRequest:function(ae){var q={timeout:300000,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:true,maxRequest:-1,reconnect:true,maxStreamingLength:10000000,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:false,rewriteURL:false,attachHeadersAsQueryString:true,executeCallbackBeforeReconnect:false,readyState:0,withCredentials:false,trackMessageLength:false,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropHeaders:true,uuid:0,shared:false,readResponsesHeaders:false,maxReconnectOnClose:5,enableProtocol:true,disableDisconnect:false,pollingInterval:0,heartbeat:{client:null,server:null},ackInterval:0,reconnectOnServerError:true,handleOnlineOffline:true,maxWebsocketErrorRetries:1,curWebsocketErrorRetries:0,unloadBackwardCompat:false,onError:function(aK){},onClose:function(aK){},onOpen:function(aK){},onMessage:function(aK){},onReopen:function(aL,aK){},onReconnect:function(aL,aK){},onMessagePublished:function(aK){},onTransportFailure:function(aL,aK){},onLocalMessage:function(aK){},onFailureToReconnect:function(aL,aK){},onClientTimeout:function(aK){},onOpenAfterResume:function(aK){}};var au={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:false,closedByClientTimeout:false,ffTryingReconnect:false};var ay=null;var ai=null;var A=null;var o=null;var Y=null;var v=true;var aA=0;var K=0;var am="X";var aI=false;var R=null;var i;var az=null;var S=b.util.now();var z;var aH;var Z=false;aq(ae);function al(){v=true;aI=false;aA=0;ay=null;ai=null;A=null;o=null}function V(){m();al()}function x(aK){if(aK=="debug"){return q.logLevel==="debug"}else{if(aK=="info"){return q.logLevel==="info"||q.logLevel==="debug"}else{if(aK=="warn"){return q.logLevel==="warn"||q.logLevel==="info"||q.logLevel==="debug"}else{if(aK=="error"){return q.logLevel==="error"||q.logLevel==="warn"||q.logLevel==="info"||q.logLevel==="debug"}else{return false}}}}}function aJ(aK){if(x("debug")){b.util.debug(new Date()+" Atmosphere: "+aK)}}function J(aL,aK){if(au.partialMessage===""&&(aK.transport==="streaming")&&(aL.responseText.length>aK.maxStreamingLength)){return true}return false}function E(){if(q.enableProtocol&&!q.disableDisconnect&&!q.firstMessage){var aM="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+q.uuid;b.util.each(q.headers,function(aO,aQ){var aP=b.util.isFunction(aQ)?aQ.call(this,q,q,au):aQ;if(aP!=null){aM+="&"+encodeURIComponent(aO)+"="+encodeURIComponent(aP)}});var aK=q.url.replace(/([?&])_=[^&]*/,aM);aK=aK+(aK===q.url?(/\?/.test(q.url)?"&":"?")+aM:"");var aL={connected:false};var aN=new b.AtmosphereRequest(aL);aN.connectTimeout=q.connectTimeout;aN.attachHeadersAsQueryString=false;aN.dropHeaders=true;aN.url=aK;aN.contentType="text/plain";aN.transport="polling";aN.method="GET";aN.data="";aN.heartbeat=null;if(q.enableXDR){aN.enableXDR=q.enableXDR}ao("",aN)}}function I(){aJ("Closing (AtmosphereRequest._close() called)");aI=true;if(q.reconnectId){clearTimeout(q.reconnectId);delete q.reconnectId}if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer)}q.reconnect=false;au.request=q;au.state="unsubscribe";au.responseBody="";au.status=408;au.partialMessage="";q.curWebsocketErrorRetries=0;ak();E();m()}function m(){au.partialMessage="";if(q.id){clearTimeout(q.id)}if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer)}if(q.reconnectId){clearTimeout(q.reconnectId);delete q.reconnectId}if(o!=null){o.close();o=null}if(Y!=null){Y.abort();Y=null}if(A!=null){A.abort();A=null}if(ay!=null){if(ay.canSendMessage){aJ("invoking .close() on WebSocket object");ay.close()}ay=null}if(ai!=null){ai.close();ai=null}aj()}function aj(){if(i!=null){clearInterval(z);document.cookie=aH+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";i.signal("close",{reason:"",heir:!aI?S:(i.get("children")||[])[0]});i.close()}if(az!=null){az.close()}}function aq(aK){V();q=b.util.extend(q,aK);q.mrequest=q.reconnect;if(!q.reconnect){q.reconnect=true}}function aw(){return q.webSocketImpl!=null||window.WebSocket||window.MozWebSocket}function av(){var aL=b.util.getAbsoluteURL(q.url.toLowerCase());var aM=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(aL);var aK=!!(aM&&(aM[1]!=window.location.protocol||aM[2]!=window.location.hostname||(aM[3]||(aM[1]==="http:"?80:443))!=(window.location.port||(window.location.protocol==="http:"?80:443))));return window.EventSource&&(!aK||!b.util.browser.safari||b.util.browser.vmajor>=7)}function ab(){if(q.shared){az=aF(q);if(az!=null){if(x("debug")){b.util.debug("Storage service available. All communication will be local")}if(az.open(q)){return}}if(x("debug")){b.util.debug("No Storage service available.")}az=null}q.firstMessage=f==0?true:false;q.isOpen=false;q.ctime=b.util.now();if(q.uuid===0){q.uuid=f}au.closedByClientTimeout=false;if(q.transport!=="websocket"&&q.transport!=="sse"){M(q)}else{if(q.transport==="websocket"){if(!aw()){aB("Websocket is not supported, using request.fallbackTransport ("+q.fallbackTransport+")")}else{ag(false)}}else{if(q.transport==="sse"){if(!av()){aB("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+q.fallbackTransport+")")}else{D(false)}}}}}function aF(aO){var aP,aN,aS,aK="atmosphere-"+aO.url,aL={storage:function(){function aT(aX){if(aX.key===aK&&aX.newValue){aM(aX.newValue)}}if(!b.util.storage){return}var aW=window.localStorage,aU=function(aX){var aY=aW.getItem(aK+"-"+aX);return aY===null?[]:JSON.parse(aY)},aV=function(aX,aY){aW.setItem(aK+"-"+aX,JSON.stringify(aY))};return{init:function(){aV("children",aU("children").concat([S]));b.util.on(window,"storage",aT);return aU("opened")},signal:function(aX,aY){aW.setItem(aK,JSON.stringify({target:"p",type:aX,data:aY}))},close:function(){var aX=aU("children");b.util.off(window,"storage",aT);if(aX){if(aQ(aX,aO.id)){aV("children",aX)}}}}},windowref:function(){var aT=window.open("",aK.replace(/\W/g,""));if(!aT||aT.closed||!aT.callbacks){return}return{init:function(){aT.callbacks.push(aM);aT.children.push(S);return aT.opened},signal:function(aU,aV){if(!aT.closed&&aT.fire){aT.fire(JSON.stringify({target:"p",type:aU,data:aV}))}},close:function(){if(!aS){aQ(aT.callbacks,aM);aQ(aT.children,S)}}}}};function aQ(aW,aV){var aT,aU=aW.length;for(aT=0;aT<aU;aT++){if(aW[aT]===aV){aW.splice(aT,1)}}return aU!==aW.length}function aM(aT){var aV=JSON.parse(aT),aU=aV.data;if(aV.target==="c"){switch(aV.type){case"open":W("opening","local",q);break;case"close":if(!aS){aS=true;if(aU.reason==="aborted"){I()}else{if(aU.heir===S){ab()}else{setTimeout(function(){ab()},100)}}}break;case"message":l(aU,"messageReceived",200,aO.transport);break;case"localMessage":G(aU);break}}}function aR(){var aT=new RegExp("(?:^|; )("+encodeURIComponent(aK)+")=([^;]*)").exec(document.cookie);if(aT){return JSON.parse(decodeURIComponent(aT[2]))}}aP=aR();if(!aP||b.util.now()-aP.ts>1000){return}aN=aL.storage()||aL.windowref();if(!aN){return}return{open:function(){var aT;z=setInterval(function(){var aU=aP;aP=aR();if(!aP||aU.ts===aP.ts){aM(JSON.stringify({target:"c",type:"close",data:{reason:"error",heir:aU.heir}}))}},1000);aT=aN.init();if(aT){setTimeout(function(){W("opening","local",aO)},50)}return aT},send:function(aT){aN.signal("send",aT)},localSend:function(aT){aN.signal("localSend",JSON.stringify({id:S,event:aT}))},close:function(){if(!aI){clearInterval(z);aN.signal("close");aN.close()}}}}function aG(){var aL,aK="atmosphere-"+q.url,aP={storage:function(){function aQ(aS){if(aS.key===aK&&aS.newValue){aM(aS.newValue)}}if(!b.util.storage){return}var aR=window.localStorage;return{init:function(){b.util.on(window,"storage",aQ)},signal:function(aS,aT){aR.setItem(aK,JSON.stringify({target:"c",type:aS,data:aT}))},get:function(aS){return JSON.parse(aR.getItem(aK+"-"+aS))},set:function(aS,aT){aR.setItem(aK+"-"+aS,JSON.stringify(aT))},close:function(){b.util.off(window,"storage",aQ);aR.removeItem(aK);aR.removeItem(aK+"-opened");aR.removeItem(aK+"-children")}}},windowref:function(){var aR=aK.replace(/\W/g,""),aQ=document.getElementById(aR),aS;if(!aQ){aQ=document.createElement("div");aQ.id=aR;aQ.style.display="none";aQ.innerHTML='<iframe name="'+aR+'"></iframe>';document.body.appendChild(aQ)}aS=aQ.firstChild.contentWindow;return{init:function(){aS.callbacks=[aM];aS.fire=function(aT){var aU;for(aU=0;aU<aS.callbacks.length;aU++){aS.callbacks[aU](aT)}}},signal:function(aT,aU){if(!aS.closed&&aS.fire){aS.fire(JSON.stringify({target:"c",type:aT,data:aU}))}},get:function(aT){return !aS.closed?aS[aT]:null},set:function(aT,aU){if(!aS.closed){aS[aT]=aU}},close:function(){}}}};function aM(aQ){var aS=JSON.parse(aQ),aR=aS.data;if(aS.target==="p"){switch(aS.type){case"send":u(aR);break;case"localSend":G(aR);break;case"close":I();break}}}R=function aO(aQ){aL.signal("message",aQ)};function aN(){document.cookie=aH+"="+encodeURIComponent(JSON.stringify({ts:b.util.now()+1,heir:(aL.get("children")||[])[0]}))+"; path=/"}aL=aP.storage()||aP.windowref();aL.init();if(x("debug")){b.util.debug("Installed StorageService "+aL)}aL.set("children",[]);if(aL.get("opened")!=null&&!aL.get("opened")){aL.set("opened",false)}aH=encodeURIComponent(aK);aN();z=setInterval(aN,1000);i=aL}function W(aM,aP,aL){if(q.shared&&aP!=="local"){aG()}if(i!=null){i.set("opened",true)}aL.close=function(){I()};if(aA>0&&aM==="re-connecting"){aL.isReopen=true;r(au)}else{if(au.error==null){au.request=aL;var aN=au.state;au.state=aM;var aK=au.transport;au.transport=aP;var aO=au.responseBody;ak();au.responseBody=aO;au.state=aN;au.transport=aK}}}function aD(aM){aM.transport="jsonp";var aL=q,aK;if((aM!=null)&&(typeof(aM)!=="undefined")){aL=aM}Y={open:function(){var aP="atmosphere"+(++S);function aN(){aL.lastIndex=0;if(aL.openId){clearTimeout(aL.openId)}if(aL.heartbeatTimer){clearTimeout(aL.heartbeatTimer)}if(aL.reconnect&&aA++<aL.maxReconnectOnClose){W("re-connecting",aL.transport,aL);if(aA===aL.maxReconnectOnClose){}else{ap(Y,aL,aM.reconnectInterval)}aL.openId=setTimeout(function(){aa(aL)},aL.reconnectInterval+1000)}else{U(0,"maxReconnectOnClose reached")}}function aO(){var aQ=aL.url;if(aL.dispatchUrl!=null){aQ+=aL.dispatchUrl}var aS=aL.data;if(aL.attachHeadersAsQueryString){aQ=p(aL);if(aS!==""){aQ+="&X-Atmosphere-Post-Body="+encodeURIComponent(aS)}aS=""}var aR=document.head||document.getElementsByTagName("head")[0]||document.documentElement;aK=document.createElement("script");aK.src=aQ+"&jsonpTransport="+aP;aK.clean=function(){aK.clean=aK.onerror=aK.onload=aK.onreadystatechange=null;if(aK.parentNode){aK.parentNode.removeChild(aK)}if(++aM.scriptCount===2){aM.scriptCount=1;aN()}};aK.onload=aK.onreadystatechange=function(){aJ("jsonp.onload");if(!aK.readyState||/loaded|complete/.test(aK.readyState)){aK.clean()}};aK.onerror=function(){aJ("jsonp.onerror");aM.scriptCount=1;aK.clean()};aR.insertBefore(aK,aR.firstChild)}window[aP]=function(aS){aJ("jsonp.window");aM.scriptCount=0;if(aL.reconnect&&aL.maxRequest===-1||aL.requestCount++<aL.maxRequest){if(!aL.executeCallbackBeforeReconnect){ap(Y,aL,aL.pollingInterval)}if(aS!=null&&typeof aS!=="string"){try{aS=aS.message}catch(aR){}}var aQ=s(aS,aL,au);if(!aQ){l(au.responseBody,"messageReceived",200,aL.transport)}if(aL.executeCallbackBeforeReconnect){ap(Y,aL,aL.pollingInterval)}k(aL)}else{b.util.log(q.logLevel,["JSONP reconnect maximum try reached "+q.requestCount]);U(0,"maxRequest reached")}};setTimeout(function(){aO()},50)},abort:function(){if(aK&&aK.clean){aK.clean()}}};Y.open()}function ax(aK){if(q.webSocketImpl!=null){return q.webSocketImpl}else{if(window.WebSocket){return new WebSocket(aK)}else{return new MozWebSocket(aK)}}}function w(){return p(q,b.util.getAbsoluteURL(q.webSocketUrl||q.url)).replace(/^http/,"ws")}function T(){var aK=p(q);return aK}function D(aL){au.transport="sse";var aK=T();if(x("debug")){b.util.debug("Invoking executeSSE");b.util.debug("Using URL: "+aK)}if(aL&&!q.reconnect){if(ai!=null){m()}return}try{ai=new EventSource(aK,{withCredentials:q.withCredentials})}catch(aM){U(0,aM);aB("SSE failed. Downgrading to fallback transport and resending");return}if(q.connectTimeout>0){q.id=setTimeout(function(){if(!aL){m()}},q.connectTimeout)}ai.onopen=function(aN){aJ("sse.onopen");k(q);if(x("debug")){b.util.debug("SSE successfully opened")}if(!q.enableProtocol){if(!aL){W("opening","sse",q)}else{W("re-opening","sse",q)}}else{if(q.isReopen){q.isReopen=false;W("re-opening",q.transport,q)}}aL=true;if(q.method==="POST"){au.state="messageReceived";u(q.data)}};ai.onmessage=function(aO){aJ("sse.onmessage");k(q);if(!q.enableXDR&&window.location.host&&aO.origin&&aO.origin!==window.location.protocol+"//"+window.location.host){b.util.log(q.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]);return}au.state="messageReceived";au.status=200;aO=aO.data;var aN=s(aO,q,au);if(!aN){ak();au.responseBody="";au.messages=[]}};ai.onerror=function(aN){aJ("sse.onerror");clearTimeout(q.id);if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer)}if(au.closedByClientTimeout){return}af(aL);m();if(aI){b.util.log(q.logLevel,["SSE closed normally"])}else{if(!aL){aB("SSE failed. Downgrading to fallback transport and resending")}else{if(q.reconnect&&(au.transport==="sse")){if(aA++<q.maxReconnectOnClose){W("re-connecting",q.transport,q);if(q.reconnectInterval>0){q.reconnectId=setTimeout(function(){D(true)},q.reconnectInterval)}else{D(true)}au.responseBody="";au.messages=[]}else{b.util.log(q.logLevel,["SSE reconnect maximum try reached "+aA]);U(0,"maxReconnectOnClose reached")}}}}}}function ag(aL){au.transport="websocket";var aK=w(q.url);if(x("debug")){b.util.debug("Invoking executeWebSocket, using URL: "+aK)}if(aL&&!q.reconnect){if(ay!=null){m()}return}ay=ax(aK);if(q.webSocketBinaryType!=null){ay.binaryType=q.webSocketBinaryType}if(q.connectTimeout>0){q.id=setTimeout(function(){if(!aL){var aP={code:1002,reason:"Connection timeout after "+q.connectTimeout+"ms.",wasClean:false};var aO=ay;try{m()}catch(aQ){}aO.onclose(aP);return}},q.connectTimeout)}ay.onopen=function(){if(ay==null){this.close();if(q.transport=="websocket"){I()}return}aJ("websocket.onopen");k(q);d=false;if(x("debug")){b.util.debug("Websocket successfully opened")}var aO=aL;ay.canSendMessage=true;if(!q.enableProtocol){aL=true;if(aO){W("re-opening","websocket",q)}else{W("opening","websocket",q)}}if(q.method==="POST"){au.state="messageReceived";ay.send(q.data)}};ay.onmessage=function(aQ){if(ay==null){this.close();if(q.transport=="websocket"){I()}return}aJ("websocket.onmessage");k(q);if(q.enableProtocol){aL=true}au.state="messageReceived";au.status=200;aQ=aQ.data;var aO=typeof(aQ)==="string";if(aO){var aP=s(aQ,q,au);if(!aP){ak();au.responseBody="";au.messages=[]}}else{aQ=t(q,aQ);if(aQ===""){return}au.responseBody=aQ;ak();au.responseBody=null}};ay.onerror=function(){aJ("websocket.onerror");clearTimeout(q.id);if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer)}au.error=true};ay.onclose=function(aO){aJ("websocket.onclose");clearTimeout(q.id);if(au.state==="closed"){return}var aP=aO.reason;if(aP===""){switch(aO.code){case 1000:aP="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:aP="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:aP="The endpoint is terminating the connection due to a protocol error.";break;case 1003:aP="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:aP="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:aP="Unknown: no status code was provided even though one was expected.";break;case 1006:aP="Connection was closed abnormally (that is, with no close frame being sent).";break}}if(x("warn")){b.util.warn("Websocket closed, reason: "+aP+" - wasClean: "+aO.wasClean)}if(au.closedByClientTimeout||(q.handleOnlineOffline&&d)){if(q.reconnectId){clearTimeout(q.reconnectId);delete q.reconnectId}return}af(aL);au.state="closed";if(aI){b.util.log(q.logLevel,["Websocket closed normally"])}else{if(au.error){au.error=false;if(q.curWebsocketErrorRetries<q.maxWebsocketErrorRetries){q.curWebsocketErrorRetries=q.curWebsocketErrorRetries+1;ah()}}else{if(!aL&&au.transport==="websocket"&&q.fallbackTransport!=="websocket"){aB("Websocket failed on first connection attempt. Downgrading to "+q.fallbackTransport+" and resending")}else{if(q.reconnect&&au.transport==="websocket"){ah()}}}}};var aM=navigator.userAgent.toLowerCase();var aN=aM.indexOf("android")>-1;if(aN&&ay.url===undefined){ay.onclose({reason:"Android 4.1 does not support websockets.",wasClean:false})}}function t(aO,aN){var aM=aN;if(aO.transport==="polling"){return aM}if(aO.enableProtocol&&aO.firstMessage&&b.util.trim(aN).length!==0){var aP=aO.trackMessageLength?1:0;var aL=aN.split(aO.messageDelimiter);if(aL.length<=aP+1){return aM}aO.firstMessage=false;aO.uuid=b.util.trim(aL[aP]);if(aL.length<=aP+2){b.util.log("error",["Protocol data not sent by the server. If you enable protocol on client side, be sure to install JavascriptProtocol interceptor on server side.Also note that atmosphere-runtime 2.2+ should be used."])}K=parseInt(b.util.trim(aL[aP+1]),10);am=aL[aP+2];if(aO.transport!=="long-polling"){aa(aO)}f=aO.uuid;aM="";aP=aO.trackMessageLength?4:3;if(aL.length>aP+1){for(var aK=aP;aK<aL.length;aK++){aM+=aL[aK];if(aK+1!==aL.length){aM+=aO.messageDelimiter}}}if(aO.ackInterval!==0){setTimeout(function(){u("...ACK...")},aO.ackInterval)}}else{if(aO.enableProtocol&&aO.firstMessage&&b.util.browser.msie&&+b.util.browser.version.split(".")[0]<10){b.util.log(q.logLevel,["Receiving unexpected data from IE"])}else{aa(aO)}}return aM}function k(aK){clearTimeout(aK.id);if(aK.timeout>0&&aK.transport!=="polling"){aK.id=setTimeout(function(){aE(aK);E();m()},aK.timeout)}}function aE(aK){au.closedByClientTimeout=true;au.state="closedByClient";au.responseBody="";au.status=408;au.messages=[];ak()}function U(aK,aL){m();clearTimeout(q.id);au.state="error";au.reasonPhrase=aL;au.responseBody="";au.status=aK;au.messages=[];ak()}function s(aO,aN,aK){aO=t(aN,aO);if(aO.length===0){return true}aK.responseBody=aO;if(aN.trackMessageLength){aO=aK.partialMessage+aO;var aM=[];var aL=aO.indexOf(aN.messageDelimiter);if(aL!=-1){while(aL!==-1){var aQ=aO.substring(0,aL);var aP=+aQ;if(isNaN(aP)){aK.partialMessage="";throw new Error('message length "'+aQ+'" is not a number')}aL+=aN.messageDelimiter.length;if(aL+aP>aO.length){aL=-1}else{aM.push(aO.substring(aL,aL+aP));aO=aO.substring(aL+aP,aO.length);aL=aO.indexOf(aN.messageDelimiter)}}aK.partialMessage=aO;if(aM.length!==0){aK.responseBody=aM.join(aN.messageDelimiter);aK.messages=aM;return false}else{aK.responseBody="";aK.messages=[];return true}}}aK.responseBody=aO;aK.messages=[aO];return false}function ah(){m();if(aA++<q.maxReconnectOnClose){W("re-connecting",q.transport,q);if(q.reconnectInterval>0){q.reconnectId=setTimeout(function(){au.responseBody="";au.messages=[];ag(true)},q.reconnectInterval)}else{au.responseBody="";au.messages=[];ag(true)}}else{b.util.log(q.logLevel,["Websocket reconnect maximum try reached "+aA]);if(x("warn")){b.util.warn("Websocket error, reason: "+message.reason)}U(0,"maxReconnectOnClose reached")}}function aB(aK){b.util.log(q.logLevel,[aK]);if(typeof(q.onTransportFailure)!=="undefined"){q.onTransportFailure(aK,q)}else{if(typeof(b.util.onTransportFailure)!=="undefined"){b.util.onTransportFailure(aK,q)}}var aL=q.connectTimeout===-1?0:q.connectTimeout;if(q.reconnect&&q.transport!=="none"||q.transport==null){q.transport=q.fallbackTransport;q.method=q.fallbackMethod;au.transport=q.fallbackTransport;au.state="";q.fallbackTransport="none";if(aL>0){q.reconnectId=setTimeout(function(){ab()},aL)}else{ab()}}else{U(500,"Unable to reconnect with fallback transport")}}function p(aM,aK){var aL=q;if((aM!=null)&&(typeof(aM)!=="undefined")){aL=aM}if(aK==null){aK=aL.url}if(!aL.attachHeadersAsQueryString){return aK}if(aK.indexOf("X-Atmosphere-Framework")!==-1){return aK}aK+=(aK.indexOf("?")!==-1)?"&":"?";aK+="X-Atmosphere-tracking-id="+aL.uuid;aK+="&X-Atmosphere-Framework="+b.version;aK+="&X-Atmosphere-Transport="+aL.transport;if(aL.trackMessageLength){aK+="&X-Atmosphere-TrackMessageSize=true"}if(aL.heartbeat!==null&&aL.heartbeat.server!==null){aK+="&X-Heartbeat-Server="+aL.heartbeat.server}if(aL.contentType!==""){aK+="&Content-Type="+(aL.transport==="websocket"?aL.contentType:encodeURIComponent(aL.contentType))}if(aL.enableProtocol){aK+="&X-atmo-protocol=true"}b.util.each(aL.headers,function(aN,aP){var aO=b.util.isFunction(aP)?aP.call(this,aL,aM,au):aP;if(aO!=null){aK+="&"+encodeURIComponent(aN)+"="+encodeURIComponent(aO)}});return aK}function aa(aK){if(!aK.isOpen){aK.isOpen=true;W("opening",aK.transport,aK)}else{if(aK.isReopen){aK.isReopen=false;W("re-opening",aK.transport,aK)}else{if(au.state==="messageReceived"&&(aK.transport==="jsonp"||aK.transport==="long-polling")){ar(au)}else{return}}}C(aK)}function C(aL){if(aL.heartbeatTimer!=null){clearTimeout(aL.heartbeatTimer)}if(!isNaN(K)&&K>0){var aK=function(){if(x("debug")){b.util.debug("Sending heartbeat")}u(am);aL.heartbeatTimer=setTimeout(aK,K)};aL.heartbeatTimer=setTimeout(aK,K)}}function M(aO){var aL=q;if((aO!=null)||(typeof(aO)!=="undefined")){aL=aO}aL.lastIndex=0;aL.readyState=0;if((aL.transport==="jsonp")||((aL.enableXDR)&&(b.util.checkCORSSupport()))){aD(aL);return}if(b.util.browser.msie&&+b.util.browser.version.split(".")[0]<10){if((aL.transport==="streaming")){if(aL.enableXDR&&window.XDomainRequest){Q(aL)}else{aC(aL)}return}if((aL.enableXDR)&&(window.XDomainRequest)){Q(aL);return}}var aN=function(aS){aL.lastIndex=0;aA++;if(aS||(aL.reconnect&&aA<=aL.maxReconnectOnClose)){var aR=aS?0:aO.reconnectInterval;au.ffTryingReconnect=true;W("re-connecting",aO.transport,aO);ap(aM,aL,aR)}else{U(0,"maxReconnectOnClose reached")}};var aP=function(aR){if(b._beforeUnloadState){b.util.debug(new Date()+" Atmosphere: reconnectF: execution delayed due to _beforeUnloadState flag");setTimeout(function(){aN(aR)},5000)}else{aN(aR)}};var aK=function(){au.errorHandled=true;m();aP(false)};if(aL.force||(aL.reconnect&&(aL.maxRequest===-1||aL.requestCount++<aL.maxRequest))){aL.force=false;var aM=b.util.xhr();aM.hasData=false;N(aM,aL,true);if(aL.suspend){A=aM}if(aL.transport!=="polling"){au.transport=aL.transport;aM.onabort=function(){aJ("ajaxrequest.onabort");af(true)};aM.onerror=function(){aJ("ajaxrequest.onerror");au.error=true;au.ffTryingReconnect=true;try{au.status=XMLHttpRequest.status}catch(aR){au.status=500}if(!au.status){au.status=500}if(!au.errorHandled){m();aP(false)}}}aM.onreadystatechange=function(){aJ("ajaxRequest.onreadystatechange, new state: "+aM.readyState);if(aI){aJ("onreadystatechange has been ignored due to _abortingConnection flag");return}au.error=null;var aS=false;var aY=false;if(aL.transport==="streaming"&&aL.readyState>2&&aM.readyState===4){m();aP(false);return}aL.readyState=aM.readyState;if(aL.transport==="streaming"&&aM.readyState>=3){aY=true}else{if(aL.transport==="long-polling"&&aM.readyState===4){aY=true}}k(q);if(aL.transport!=="polling"){var aR=200;if(aM.readyState===4){aR=aM.status>1000?0:aM.status}if(!aL.reconnectOnServerError&&(aR>=300&&aR<600)){U(aR,aM.statusText);return}if(aR>=300||aR===0){aK();return}if((!aL.enableProtocol||!aO.firstMessage)&&aM.readyState===2){if(b.util.browser.mozilla&&au.ffTryingReconnect){au.ffTryingReconnect=false;setTimeout(function(){if(!au.ffTryingReconnect){aa(aL)}},500)}else{aa(aL)}}}else{if(aM.readyState===4){aY=true}}if(aY){var aV=aM.responseText;au.errorHandled=false;if(aL.transport==="long-polling"&&b.util.trim(aV).length===0){if(!aM.hasData){aP(true)}else{aM.hasData=false}return}aM.hasData=true;H(aM,q);if(aL.transport==="streaming"){if(!b.util.browser.opera){var aU=aV.substring(aL.lastIndex,aV.length);aS=s(aU,aL,au);aL.lastIndex=aV.length;if(aS){return}}else{b.util.iterate(function(){if(au.status!==500&&aM.responseText.length>aL.lastIndex){try{au.status=aM.status;au.headers=b.util.parseHeaders(aM.getAllResponseHeaders());H(aM,q)}catch(a0){au.status=404}k(q);au.state="messageReceived";var aZ=aM.responseText.substring(aL.lastIndex);aL.lastIndex=aM.responseText.length;aS=s(aZ,aL,au);if(!aS){ak()}if(J(aM,aL)){L(aM,aL);return}}else{if(au.status>400){aL.lastIndex=aM.responseText.length;return false}}},0)}}else{aS=s(aV,aL,au)}var aX=J(aM,aL);try{au.status=aM.status;au.headers=b.util.parseHeaders(aM.getAllResponseHeaders());H(aM,aL)}catch(aW){au.status=404}if(aL.suspend){au.state=au.status===0?"closed":"messageReceived"}else{au.state="messagePublished"}var aT=!aX&&aO.transport!=="streaming"&&aO.transport!=="polling";if(aT&&!aL.executeCallbackBeforeReconnect){ap(aM,aL,aL.pollingInterval)}if(au.responseBody.length!==0&&!aS){ak()}if(aT&&aL.executeCallbackBeforeReconnect){ap(aM,aL,aL.pollingInterval)}if(aX){L(aM,aL)}}};try{aM.send(aL.data);v=true}catch(aQ){b.util.log(aL.logLevel,["Unable to connect to "+aL.url]);U(0,aQ)}}else{if(aL.logLevel==="debug"){b.util.log(aL.logLevel,["Max re-connection reached."])}U(0,"maxRequest reached")}}function L(aL,aK){au.messages=[];aK.isReopen=true;I();aI=false;ap(aL,aK,500)}function N(aM,aN,aL){var aK=aN.url;if(aN.dispatchUrl!=null&&aN.method==="POST"){aK+=aN.dispatchUrl}aK=p(aN,aK);aK=b.util.prepareURL(aK);if(aL){aM.open(aN.method,aK,true);if(aN.connectTimeout>0){aN.id=setTimeout(function(){if(aN.requestCount===0){m();l("Connect timeout","closed",200,aN.transport)}},aN.connectTimeout)}}if(q.withCredentials&&q.transport!=="websocket"){if("withCredentials" in aM){aM.withCredentials=true}}if(!q.dropHeaders){aM.setRequestHeader("X-Atmosphere-Framework",b.version);aM.setRequestHeader("X-Atmosphere-Transport",aN.transport);if(aN.heartbeat!==null&&aN.heartbeat.server!==null){aM.setRequestHeader("X-Heartbeat-Server",aM.heartbeat.server)}if(aN.trackMessageLength){aM.setRequestHeader("X-Atmosphere-TrackMessageSize","true")}aM.setRequestHeader("X-Atmosphere-tracking-id",aN.uuid);b.util.each(aN.headers,function(aO,aQ){var aP=b.util.isFunction(aQ)?aQ.call(this,aM,aN,aL,au):aQ;if(aP!=null){aM.setRequestHeader(aO,aP)}})}if(aN.contentType!==""){aM.setRequestHeader("Content-Type",aN.contentType)}}function ap(aM,aN,aL){if(au.closedByClientTimeout){return}if(aN.reconnect||(aN.suspend&&v)){var aK=0;if(aM&&aM.readyState>1){aK=aM.status>1000?0:aM.status}au.status=aK===0?204:aK;au.reason=aK===0?"Server resumed the connection or down.":"OK";clearTimeout(aN.id);if(aN.reconnectId){clearTimeout(aN.reconnectId);delete aN.reconnectId}if(aL>0){q.reconnectId=setTimeout(function(){M(aN)},aL)}else{M(aN)}}}function r(aK){aK.state="re-connecting";an(aK)}function ar(aK){aK.state="openAfterResume";an(aK);aK.state="messageReceived"}function Q(aK){if(aK.transport!=="polling"){o=ad(aK);o.open()}else{ad(aK).open()}}function ad(aM){var aL=q;if((aM!=null)&&(typeof(aM)!=="undefined")){aL=aM}var aR=aL.transport;var aQ=0;var aK=new window.XDomainRequest();var aO=function(){if(aL.transport==="long-polling"&&(aL.reconnect&&(aL.maxRequest===-1||aL.requestCount++<aL.maxRequest))){aK.status=200;Q(aL)}};var aP=aL.rewriteURL||function(aT){var aS=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(aS&&aS[1]){case"JSESSIONID":return aT.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+aS[2]+"$1");case"PHPSESSID":return aT.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+aS[2]+"&").replace(/&$/,"")}return aT};aK.onprogress=function(){aN(aK)};aK.onerror=function(){if(aL.transport!=="polling"){m();if(aA++<aL.maxReconnectOnClose){if(aL.reconnectInterval>0){aL.reconnectId=setTimeout(function(){W("re-connecting",aM.transport,aM);Q(aL)},aL.reconnectInterval)}else{W("re-connecting",aM.transport,aM);Q(aL)}}else{U(0,"maxReconnectOnClose reached")}}};aK.onload=function(){};var aN=function(aS){clearTimeout(aL.id);var aU=aS.responseText;aU=aU.substring(aQ);aQ+=aU.length;if(aR!=="polling"){k(aL);var aT=s(aU,aL,au);if(aR==="long-polling"&&b.util.trim(aU).length===0){return}if(aL.executeCallbackBeforeReconnect){aO()}if(!aT){l(au.responseBody,"messageReceived",200,aR)}if(!aL.executeCallbackBeforeReconnect){aO()}}};return{open:function(){var aS=aL.url;if(aL.dispatchUrl!=null){aS+=aL.dispatchUrl}aS=p(aL,aS);aK.open(aL.method,aP(aS));if(aL.method==="GET"){aK.send()}else{aK.send(aL.data)}if(aL.connectTimeout>0){aL.id=setTimeout(function(){if(aL.requestCount===0){m();l("Connect timeout","closed",200,aL.transport)}},aL.connectTimeout)}},close:function(){aK.abort()}}}function aC(aK){o=ac(aK);o.open()}function ac(aN){var aM=q;if((aN!=null)&&(typeof(aN)!=="undefined")){aM=aN}var aL;var aO=new window.ActiveXObject("htmlfile");aO.open();aO.close();var aK=aM.url;if(aM.dispatchUrl!=null){aK+=aM.dispatchUrl}if(aM.transport!=="polling"){au.transport=aM.transport}return{open:function(){var aP=aO.createElement("iframe");aK=p(aM);if(aM.data!==""){aK+="&X-Atmosphere-Post-Body="+encodeURIComponent(aM.data)}aK=b.util.prepareURL(aK);aP.src=aK;aO.body.appendChild(aP);var aQ=aP.contentDocument||aP.contentWindow.document;aL=b.util.iterate(function(){try{if(!aQ.firstChild){return}var aT=aQ.body?aQ.body.lastChild:aQ;if(aT.omgThisIsBroken){}var aV=function(){var aX=aT.cloneNode(true);aX.appendChild(aQ.createTextNode("."));var aW=aX.innerText;aW=aW.substring(0,aW.length-1);return aW};if(!aQ.body||!aQ.body.firstChild||aQ.body.firstChild.nodeName.toLowerCase()!=="pre"){var aS=aQ.head||aQ.getElementsByTagName("head")[0]||aQ.documentElement||aQ;var aR=aQ.createElement("script");aR.text="document.write('<plaintext>')";aS.insertBefore(aR,aS.firstChild);aS.removeChild(aR);aT=aQ.body.lastChild}if(aM.closed){aM.isReopen=true}aL=b.util.iterate(function(){var aX=aV();if(aX.length>aM.lastIndex){k(q);au.status=200;au.error=null;aT.innerText="";var aW=s(aX,aM,au);if(aW){return""}l(au.responseBody,"messageReceived",200,aM.transport)}aM.lastIndex=0;if(aQ.readyState==="complete"){af(true);W("re-connecting",aM.transport,aM);if(aM.reconnectInterval>0){aM.reconnectId=setTimeout(function(){aC(aM)},aM.reconnectInterval)}else{aC(aM)}return false}},null);return false}catch(aU){au.error=true;W("re-connecting",aM.transport,aM);if(aA++<aM.maxReconnectOnClose){if(aM.reconnectInterval>0){aM.reconnectId=setTimeout(function(){aC(aM)},aM.reconnectInterval)}else{aC(aM)}}else{U(0,"maxReconnectOnClose reached")}aO.execCommand("Stop");aO.close();return false}})},close:function(){if(aL){aL()}aO.execCommand("Stop");af(true)}}}function u(aK){if(az!=null){F(aK)}else{if(A!=null||ai!=null){P(aK)}else{if(o!=null){j(aK)}else{if(Y!=null){B(aK)}else{if(ay!=null){X(aK)}else{U(0,"No suspended connection available");b.util.error("No suspended connection available. Make sure atmosphere.subscribe has been called and request.onOpen invoked before trying to push data")}}}}}}function ao(aL,aK){if(!aK){aK=y(aL)}aK.transport="polling";aK.method="GET";aK.withCredentials=false;aK.reconnect=false;aK.force=true;aK.suspend=false;aK.timeout=1000;if(aK.unloadBackwardCompat){M(aK)}else{navigator.sendBeacon(aK.url,aK.data)}}function F(aK){az.send(aK)}function at(aL){if(aL.length===0){return}try{if(az){az.localSend(aL)}else{if(i){i.signal("localMessage",JSON.stringify({id:S,event:aL}))}}}catch(aK){b.util.error(aK)}}function P(aL){var aK=y(aL);M(aK)}function j(aL){if(q.enableXDR&&b.util.checkCORSSupport()){var aK=y(aL);aK.reconnect=false;aD(aK)}else{P(aL)}}function B(aK){P(aK)}function O(aK){var aL=aK;if(typeof(aL)==="object"){aL=aK.data}return aL}function y(aL){var aM=O(aL);var aK={connected:false,timeout:60000,method:"POST",url:q.url,contentType:q.contentType,headers:q.headers,reconnect:true,callback:null,data:aM,suspend:false,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:q.withCredentials,transport:"polling",isOpen:true,attachHeadersAsQueryString:true,enableXDR:q.enableXDR,uuid:q.uuid,dispatchUrl:q.dispatchUrl,enableProtocol:false,messageDelimiter:"|",trackMessageLength:q.trackMessageLength,maxReconnectOnClose:q.maxReconnectOnClose,heartbeatTimer:q.heartbeatTimer,heartbeat:q.heartbeat};if(typeof(aL)==="object"){aK=b.util.extend(aK,aL)}return aK}function X(aK){var aN=b.util.isBinary(aK)?aK:O(aK);var aL;try{if(q.dispatchUrl!=null){aL=q.webSocketPathDelimiter+q.dispatchUrl+q.webSocketPathDelimiter+aN}else{aL=aN}if(!ay.canSendMessage){b.util.error("WebSocket not connected.");return}ay.send(aL)}catch(aM){ay.onclose=function(aO){};m();aB("Websocket failed. Downgrading to "+q.fallbackTransport+" and resending "+aK);P(aK)}}function G(aL){var aK=JSON.parse(aL);if(aK.id!==S){if(typeof(q.onLocalMessage)!=="undefined"){q.onLocalMessage(aK.event)}else{if(typeof(b.util.onLocalMessage)!=="undefined"){b.util.onLocalMessage(aK.event)}}}}function l(aN,aK,aL,aM){au.responseBody=aN;au.transport=aM;au.status=aL;au.state=aK;ak()}function H(aK,aM){if(!aM.readResponsesHeaders){if(!aM.enableProtocol){aM.uuid=S}}else{try{var aL=aK.getResponseHeader("X-Atmosphere-tracking-id");if(aL&&aL!=null){aM.uuid=aL.split(" ").pop()}}catch(aN){}}}function an(aK){n(aK,q);n(aK,b.util)}function n(aL,aM){switch(aL.state){case"messageReceived":aJ("Firing onMessage");aA=0;if(typeof(aM.onMessage)!=="undefined"){aM.onMessage(aL)}if(typeof(aM.onmessage)!=="undefined"){aM.onmessage(aL)}break;case"error":var aN=(typeof(aL.reasonPhrase)!="undefined")?aL.reasonPhrase:"n/a";aJ("Firing onError, reasonPhrase: "+aN);if(typeof(aM.onError)!=="undefined"){aM.onError(aL)}if(typeof(aM.onerror)!=="undefined"){aM.onerror(aL)}break;case"opening":delete q.closed;aJ("Firing onOpen");if(typeof(aM.onOpen)!=="undefined"){aM.onOpen(aL)}if(typeof(aM.onopen)!=="undefined"){aM.onopen(aL)}break;case"messagePublished":aJ("Firing messagePublished");if(typeof(aM.onMessagePublished)!=="undefined"){aM.onMessagePublished(aL)}break;case"re-connecting":aJ("Firing onReconnect");if(typeof(aM.onReconnect)!=="undefined"){aM.onReconnect(q,aL)}break;case"closedByClient":aJ("Firing closedByClient");if(typeof(aM.onClientTimeout)!=="undefined"){aM.onClientTimeout(q)}break;case"re-opening":delete q.closed;aJ("Firing onReopen");if(typeof(aM.onReopen)!=="undefined"){aM.onReopen(q,aL)}break;case"fail-to-reconnect":aJ("Firing onFailureToReconnect");if(typeof(aM.onFailureToReconnect)!=="undefined"){aM.onFailureToReconnect(q,aL)}break;case"unsubscribe":case"closed":var aK=typeof(q.closed)!=="undefined"?q.closed:false;if(!aK){aJ("Firing onClose ("+aL.state+" case)");if(typeof(aM.onClose)!=="undefined"){aM.onClose(aL)}if(typeof(aM.onclose)!=="undefined"){aM.onclose(aL)}}else{aJ("Request already closed, not firing onClose ("+aL.state+" case)")}q.closed=true;break;case"openAfterResume":if(typeof(aM.onOpenAfterResume)!=="undefined"){aM.onOpenAfterResume(q)}break}}function af(aK){if(au.state!=="closed"){au.state="closed";au.responseBody="";au.messages=[];au.status=!aK?501:200;ak()}}function ak(){var aM=function(aP,aQ){aQ(au)};if(az==null&&R!=null){R(au.responseBody)}q.reconnect=q.mrequest;var aK=typeof(au.responseBody)==="string";var aN=(aK&&q.trackMessageLength)?(au.messages.length>0?au.messages:[""]):new Array(au.responseBody);for(var aL=0;aL<aN.length;aL++){if(aN.length>1&&aN[aL].length===0){continue}au.responseBody=(aK)?b.util.trim(aN[aL]):aN[aL];if(az==null&&R!=null){R(au.responseBody)}if(au.state==="messageReceived"){if(au.responseBody.length===0){continue}else{if(aK&&am===au.responseBody){aA=0;continue}}}an(au);if(g.length>0){if(x("debug")){b.util.debug("Invoking "+g.length+" global callbacks: "+au.state)}try{b.util.each(g,aM)}catch(aO){b.util.log(q.logLevel,["Callback exception"+aO])}}if(typeof(q.callback)==="function"){if(x("debug")){b.util.debug("Invoking request callbacks")}try{q.callback(au)}catch(aO){b.util.log(q.logLevel,["Callback exception"+aO])}}}}this.subscribe=function(aK){aq(aK);ab()};this.execute=function(){ab()};this.close=function(){I()};this.disconnect=function(){E()};this.getUrl=function(){return q.url};this.push=function(aM,aL){if(aL!=null){var aK=q.dispatchUrl;q.dispatchUrl=aL;u(aM);q.dispatchUrl=aK}else{u(aM)}};this.getUUID=function(){return q.uuid};this.pushLocal=function(aK){at(aK)};this.enableProtocol=function(aK){return q.enableProtocol};this.init=function(){al()};this.request=q;this.response=au}};b.subscribe=function(i,l,k){if(typeof(l)==="function"){b.addCallback(l)}if(typeof(i)!=="string"){k=i}else{k.url=i}f=((typeof(k)!=="undefined")&&typeof(k.uuid)!=="undefined")?k.uuid:0;var j=new b.AtmosphereRequest(k);j.execute();h[h.length]=j;return j};b.unsubscribe=function(){if(h.length>0){var j=[].concat(h);for(var l=0;l<j.length;l++){var k=j[l];k.close();clearTimeout(k.response.request.id);if(k.heartbeatTimer){clearTimeout(k.heartbeatTimer)}}}h=[];g=[]};b.unsubscribeUrl=function(k){var j=-1;if(h.length>0){for(var m=0;m<h.length;m++){var l=h[m];if(l.getUrl()===k){l.close();clearTimeout(l.response.request.id);if(l.heartbeatTimer){clearTimeout(l.heartbeatTimer)}j=m;break}}}if(j>=0){h.splice(j,1)}};b.addCallback=function(i){if(b.util.inArray(i,g)===-1){g.push(i)}};b.removeCallback=function(j){var i=b.util.inArray(j,g);if(i!==-1){g.splice(i,1)}};b.util={browser:{},parseHeaders:function(j){var i,l=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,k={};while(i=l.exec(j)){k[i[1]]=i[2]}return k},now:function(){return new Date().getTime()},isArray:function(i){return Object.prototype.toString.call(i)==="[object Array]"},inArray:function(l,m){if(!Array.prototype.indexOf){var j=m.length;for(var k=0;k<j;++k){if(m[k]===l){return k}}return -1}return m.indexOf(l)},isBinary:function(i){return/^\[object\s(?:Blob|ArrayBuffer|.+Array)\]$/.test(Object.prototype.toString.call(i))},isFunction:function(i){return Object.prototype.toString.call(i)==="[object Function]"},getAbsoluteURL:function(i){if(typeof(document.createElement)==="undefined"){return i}var k=document.createElement("div");k.innerHTML='<a href="'+i+'"></a>';var j=window.navigator.userAgent;if(j.indexOf("MSIE ")>0||j.indexOf("Trident/")>0||j.indexOf("Edge/")>0){return b.util.fixedEncodeURI(decodeURI(k.firstChild.href))}return k.firstChild.href},fixedEncodeURI:function(i){return encodeURI(i).replace(/%5B/g,"[").replace(/%5D/g,"]")},prepareURL:function(j){var k=b.util.now();var i=j.replace(/([?&])_=[^&]*/,"$1_="+k);return i+(i===j?(/\?/.test(j)?"&":"?")+"_="+k:"")},trim:function(i){if(!String.prototype.trim){return i.toString().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")}else{return i.toString().trim()}},param:function(m){var k,i=[];function l(n,o){o=b.util.isFunction(o)?o():(o==null?"":o);i.push(encodeURIComponent(n)+"="+encodeURIComponent(o))}function j(o,p){var n;if(b.util.isArray(p)){b.util.each(p,function(r,q){if(/\[\]$/.test(o)){l(o,q)}else{j(o+"["+(typeof q==="object"?r:"")+"]",q)}})}else{if(Object.prototype.toString.call(p)==="[object Object]"){for(n in p){j(o+"["+n+"]",p[n])}}else{l(o,p)}}}for(k in m){j(k,m[k])}return i.join("&").replace(/%20/g,"+")},storage:function(){try{return !!(window.localStorage&&window.StorageEvent)}catch(i){return false}},iterate:function(k,j){var l;j=j||0;(function i(){l=setTimeout(function(){if(k()===false){return}i()},j)})();return function(){clearTimeout(l)}},each:function(o,p,k){if(!o){return}var n,l=0,m=o.length,j=b.util.isArray(o);if(k){if(j){for(;l<m;l++){n=p.apply(o[l],k);if(n===false){break}}}else{for(l in o){n=p.apply(o[l],k);if(n===false){break}}}}else{if(j){for(;l<m;l++){n=p.call(o[l],l,o[l]);if(n===false){break}}}else{for(l in o){n=p.call(o[l],l,o[l]);if(n===false){break}}}}return o},extend:function(m){var l,k,j;for(l=1;l<arguments.length;l++){if((k=arguments[l])!=null){for(j in k){m[j]=k[j]}}}return m},on:function(k,j,i){if(k.addEventListener){k.addEventListener(j,i,false)}else{if(k.attachEvent){k.attachEvent("on"+j,i)}}},off:function(k,j,i){if(k.removeEventListener){k.removeEventListener(j,i,false)}else{if(k.detachEvent){k.detachEvent("on"+j,i)}}},log:function(k,j){if(window.console){var i=window.console[k];if(typeof i==="function"){i.apply(window.console,j)}}},warn:function(){b.util.log("warn",arguments)},info:function(){b.util.log("info",arguments)},debug:function(){b.util.log("debug",arguments)},error:function(){b.util.log("error",arguments)},xhr:function(){try{return new window.XMLHttpRequest()}catch(j){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(i){}}},checkCORSSupport:function(){if(b.util.browser.msie&&!window.XDomainRequest&&+b.util.browser.version.split(".")[0]<11){return true}else{if(b.util.browser.opera&&+b.util.browser.version.split(".")<12){return true}else{if(b.util.trim(navigator.userAgent).slice(0,16)==="KreaTVWebKit/531"){return true}else{if(b.util.trim(navigator.userAgent).slice(-7).toLowerCase()==="kreatel"){return true}}}}var j=navigator.userAgent.toLowerCase();var k=j.match(/.+android ([0-9]{1,2})/i),i=parseInt((k&&k[0])||-1,10);if(!isNaN(i)&&i>-1&&i<3){return true}return false}};e=b.util.now();(function(){var j=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(j)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(j)||/(msie) ([\w.]+)/.exec(j)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(j)||j.indexOf("android")<0&&/version\/(.+) (safari)/.exec(j)||j.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(j)||[];if(i[2]==="safari"){i[2]=i[1];i[1]="safari"}b.util.browser[i[1]||""]=true;b.util.browser.version=i[2]||"0";b.util.browser.vmajor=b.util.browser.version.split(".")[0];if(b.util.browser.trident){b.util.browser.msie=true}if(b.util.browser.msie||(b.util.browser.mozilla&&+b.util.browser.version.split(".")[0]===1)){b.util.storage=false}})();b.callbacks={unload:function(){b.util.debug(new Date()+" Atmosphere: unload event");b.unsubscribe()},beforeUnload:function(){b.util.debug(new Date()+" Atmosphere: beforeunload event");b._beforeUnloadState=true;setTimeout(function(){b.util.debug(new Date()+" Atmosphere: beforeunload event timeout reached. Reset _beforeUnloadState flag");b._beforeUnloadState=false},5000)},offline:function(){b.util.debug(new Date()+" Atmosphere: offline event");d=true;if(h.length>0){var j=[].concat(h);for(var l=0;l<j.length;l++){var k=j[l];if(k.request.handleOnlineOffline){k.close();clearTimeout(k.response.request.id);if(k.heartbeatTimer){clearTimeout(k.heartbeatTimer)}}}}},online:function(){b.util.debug(new Date()+" Atmosphere: online event");if(h.length>0){for(var j=0;j<h.length;j++){if(h[j].request.handleOnlineOffline){h[j].init();h[j].execute()}}}d=false}};b.bindEvents=function(){b.util.on(window,"unload",b.callbacks.unload);b.util.on(window,"beforeunload",b.callbacks.beforeUnload);b.util.on(window,"offline",b.callbacks.offline);b.util.on(window,"online",b.callbacks.online)};b.unbindEvents=function(){b.util.off(window,"unload",b.callbacks.unload);b.util.off(window,"beforeunload",b.callbacks.beforeUnload);b.util.off(window,"offline",b.callbacks.offline);b.util.off(window,"online",b.callbacks.online)};b.bindEvents();return b}));if(window.console){window.console.log("Vaadin push loaded")}}).call(window.vaadinPush);